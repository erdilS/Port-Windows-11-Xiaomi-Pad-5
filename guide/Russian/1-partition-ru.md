<img align="right" src="https://raw.githubusercontent.com/erdilS/Port-Windows-11-Xiaomi-Pad-5/main/nabu.png" width="425" alt="Windows 11 Running On A Xiaomi Pad 5">

# Запуск Windows на Xiaomi Pad 5

## Установка

### Требования
- ```Разблокированный загрузчик``` - (если он у вас заблокирован, посмотрите [этот](unlock-bootloader-ru.md) гайд для разблокировки)

-  ```Мозг```

- ```ПК/Ноутбук c Windows 10(или выше)```

- [```SDK platform-tools```](https://developer.android.com/studio/releases/platform-tools)

- [```Модифицированный образ recovery```](https://github.com/erdilS/Port-Windows-11-Xiaomi-Pad-5/releases/download/1.0/recovery.img)

### Заметки:
> [!NOTE]
> Вы можете использовать любую прошивку Android для дуалбута - MIUI, HyperOS или любую другую

> [!WARNING]
> Все ваши данные будут удалены! Создайте резервную копию, если необходимо.
> 
>  Если вы считаете, что допустили ошибку, НЕ ПЕРЕЗАГРУЖАЙТЕ ПЛАНШЕТ: обратитесь за помощью в [чат Telegram](https://t.me/nabuwoaru)

### Откройте CMD от имени администратора
- Распакуйте загруженные [```SDK platform-tools```](https://developer.android.com/studio/releases/platform-tools), затем откройте командную строку от имени администратора и запустите следующую команду, заменив `путь\к\platform-tools` на фактический путь к папке platform tools
```cmd
cd путь\к\platform-tools
```
- Используйте это окно на протяжении всего руководства. Не закрывайте его.

#### Перезагрузка в fastboot 
- Перезагрузите NABU в **fastboot**, удерживая нажатой кнопку **`уменьшения громкости`** во время перезагрузки с подключенным USB-кабелем.
- Или, если у вас включена отладка по USB, выполните команду ниже, находясь в Android с подключенным USB-кабелем.
```cmd
adb reboot bootloader
```
> [!NOTE]
> Если ваше устройство не определяется в fastboot или recovery, вам необходимо установить драйверы USB с помощью [этого](troubleshooting-ru.md#device-is-not-recognized-in-fastboot-or-recovery) гайда.


### Загрузка в модифицированный recovery
> Находясь в режиме fastboot, замените `путь\к\recovery.img` фактическим путем к образу recovery
```cmd
fastboot boot путь\к\recovery.img
```

### Создайте резервную копию вашего существующего загрузочного образа
```cmd
adb shell "dd if=/dev/block/platform/soc/1d84000.ufshc/by-name/boot$(getprop ro.boot.slot_suffix) of=/tmp/normal_boot.img" && adb pull /tmp/normal_boot.img
```

### Разметка хранилища устройства
> Существует два способа разметки хранилища устройства. Пожалуйста, выберите способ, который вы хотите использовать, ниже.
 
> [!NOTE]
>
> Нажмите ▶, чтобы развернуть меню.

### Способ 1: автоматическая разметка (рекомендуется)

<details>
  <summary><strong>Нажмите здесь, чтобы перейти к способу 1</strong></summary> 

### Запустите скрипт разметки

> Замените **$** на объём памяти, который вы хотите выделить для Windows (не добавляйте ГБ, просто напишите число)
> 
> Скрипт может попросить вас запустить его еще раз. В таком случае, выполните эту же команду заново.
```cmd
adb shell partition $
```

### [Следующий шаг: получение root-доступа на вашем устройстве](/guide/Russian/2-rootguide-ru.md)

</details>

----

### Способ 2: ручная разметка (используйте этот способ только в том случае, если вы знаете, что делаете)

<details>
  <summary><strong>Нажмите здесь, чтобы перейти к способу 2</strong></summary>  

#### Размонтируйте раздел userdata
> Если после выполнения следующей команды вы получили ошибку, проигнорируете её
```cmd
adb shell umount /dev/block/by-name/userdata
``` 

#### Изменение размера таблицы разделов
```cmd
adb shell sgdisk --resize-table 64 /dev/block/sda
```

### Подготовка к разметке
```cmd
adb shell parted /dev/block/sda
``` 

#### Вывод текущей таблицы разделов
> Parted выведет список разделов, **userdata** должен быть последним в списке
```cmd
print
``` 

#### Удаление раздела userdata
> Замените **$** на номер раздела **userdata**, который должен быть равен **31**
```cmd
rm $
``` 

#### Создание раздела под Android 
> Замените **10.9GB** на предыдущее начальное значение **userdata**, которое мы только что удалили
>
> Замените **70GB** на конечное значение, которое вы хотите присвоить **userdata**. В этом примере доступное для использования пространство в Android составит 70GB — 10.9GB = **59GB**
```cmd
mkpart userdata ext4 10.9GB 70GB
``` 

#### Создание раздела ESP
> Замените **70GB** на конечное значение **userdata**
>
> Замените **70.3GB** на значение, которое вы использовали ранее, добавив к нему **0.3GB**
```cmd
mkpart esp fat32 70GB 70.3GB
``` 

#### Создание раздела Windows
> Замените **70.3GB** на конечное значение **esp**
```cmd
mkpart win ntfs 70.3GB -0MB
``` 

#### Делаем ESP загрузочным
> Используйте `print`, чтобы увидеть все разделы. Замените "$" на номер раздела ESP, который должен быть **32**
```cmd
set $ esp on
``` 

#### Выход из parted
```cmd
quit
``` 

### Форматирование разделов Windows и ESP
> Убедитесь, что у раздела **win** действительно номер раздела **33**, прокрутив вверх вывод команды `print`
```cmd
adb shell mkfs.ntfs -f /dev/block/sda33 -L WINNABU
``` 

> Убедитесь, что у раздела **esp** действительно указан номер раздела **32**, прокрутив до вывода команды `print`
```cmd
adb shell mkfs.fat -F32 -s1 /dev/block/sda32 -n ESPNABU
```

### Исправление GPT
> В противном случае Windows может превратить ваше устройство в кирпич
```cmd
adb shell fix gpt
```

#### Перезагрузите свое устройство
> Для проверки, запускается ли Android
>
> Если нет, перезагрузите устройство в режим **recovery** и **выполните сброс до заводских настроек**
```cmd
adb reboot recovery
```

### [Следующий шаг: получение root-прав на вашем устройстве](/guide/Russian/2-rootguide-ru.md)

----

</details>
